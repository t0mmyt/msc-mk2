{% extends "base.html" %}
{% block title %}Explore{% endblock %}
{% block heading %}Explore Data{% endblock %}
{% block head %}
<!-- TODO - Move this to footer? -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.3/d3.min.js"></script>
{% endblock %}
{% block contents %}
<style>
.line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2px;
}
</style>
<script>
data = d3.json("http://localhost:8003/v1/metrics/Z?start=131540692000&end=1315493280000&station=NAB1&network=YW",
  function(d) {
    r = d.results;
    render(r);
  }
);

var w = 1000;
var h = 400;
var padding = 20;

var svg = d3.select("#contents")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

function render(dataset) {
  var xScale = d3.scaleLinear()
                       .domain([
                         d3.min(dataset, function(d) { return d[0]; }),
                         d3.max(dataset, function(d) { return d[0]; })
                       ])
                       .range([padding, w - padding * 4]);

  var yScale = d3.scaleLinear()
                       .domain([
                         d3.min(dataset, function(d) { return d[1]; }),
                         d3.max(dataset, function(d) { return d[1]; })
                       ])
                       .range([h - padding, padding]);

  var xAxis = d3.axisBottom()
                .ticks(10)
                .tickFormat(d3.timeFormat("%H:%M:%S"))
                .scale(xScale);

  var yAxis = d3.axisRight()
                .scale(yScale);

  var line = d3.line()
    .x(function(d) {return dataset[0]})
    .y(function(d) {return dataset[1]});

  svg.append("g")
      .call(xAxis)
      .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");
  svg.append("g")
      .call(yAxis);

  svg.append("path")
        .data([dataset])
        .attr("class", "line")
        .attr("d", line);

  // svg.selectAll("circle")
  //    .data(dataset)
  //    .enter()
  //    .append("circle")
  //    .attr("r", 1)
  //    .attr("cx", function(d) {
  //      return xScale(d[0]);
  //    })
  //    .attr("cy", function(d){
  //      return yScale(d[1]);
  //    });

  // svg.selectAll("text")
  //    .data(dataset)
  //    .enter()
  //    .append("text")
  //    .text(function(d) {
  //      return d[0] + "," + d[1];
  //    })
  //    .attr("x", function(d) {
  //      return xScale(d[0]);
  //    })
  //    .attr("y", function(d) {
  //      return yScale(d[1]);
  //    })
    //  .attr("fill", "red");
};
</script>
{% endblock %}
